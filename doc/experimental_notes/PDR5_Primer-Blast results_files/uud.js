var $jscomp={scope:{},inherits:function(g,q){function p(){}p.prototype=q.prototype;g.prototype=new p;g.prototype.constructor=g;for(var h in q)if(Object.defineProperties){var t=Object.getOwnPropertyDescriptor(q,h);t&&Object.defineProperty(g,h,t)}else g[h]=q[h]}};
(function(g){jQuery.support.cors=!0;"undefined"===typeof UUD&&(UUD={});jQuery.extend(UUD,{uud_cgi_path:"https://uud.ncbi.nlm.nih.gov/projects/uud/",uud_ul_cgi_path:"https://uud.ncbi.nlm.nih.gov/projects/uud/ul/",genome_uud_cgi_path:"https://uud.ncbi.nlm.nih.gov/projects/genome/uud/",featloc_cgi_path:"https://uud.ncbi.nlm.nih.gov/projects/genome/trackmgr/featloc/",uud_cgis:{"dl-meta":"dl_meta.cgi","sv-dl":"sv_dl.cgi"},uud_ul_cgis:{"file-upload":"file_upload.cgi"},genome_uud_cgis:{registerdl:"registerdl.cgi"},
featloc_cgis:{"featid-dl":"featid_dl.cgi","featqry-dl":"featqry_dl.cgi"},uud_version:"0.1.11",logErrors:!0,GetUUDCgiUrl:function(a){if(void 0===UUD.x_Cgi_paths){UUD.x_Cgi_paths={};var b=function(a,b){jQuery.each(b,function(b,d){UUD.x_Cgi_paths.hasOwnProperty(b)||(UUD.x_Cgi_paths[b]=a+d)})};b(UUD.uud_cgi_path,UUD.uud_cgis);b(UUD.uud_ul_cgi_path,UUD.uud_ul_cgis);b(UUD.genome_uud_cgi_path,UUD.genome_uud_cgis);b(UUD.featloc_cgi_path,UUD.featloc_cgis)}return UUD.x_Cgi_paths[a]},ValidateConfig:function(a,
b){var c={};if(null!=a&&null!=b){var d=[];jQuery.each(b,function(b,c){a.hasOwnProperty(c)||d.push(new UUD.Error("Required attribute not specified: "+c))});0<d.length&&(c.errors=d)}return c}});g=function(a,b){jQuery.extend(this,a);for(var c in a)a.hasOwnProperty(c)&&(this[c.toUpperCase()]=this[c]);this._getEnumName=function(){return b}};g.prototype.IsValid=function(a){for(var b in this)if(this.hasOwnProperty(b)&&a==this[b])return!0;return!1};g.prototype.ValidatedValue=function(a,b){var c=b;b=void 0!==
b||void 0!==this.Default||void 0!==this.DEFAULT;this.IsValid(a)?(c=a,b=!0):c=c||this.Default||this.DEFAULT;!b&&window.console&&this._getEnumName&&window.console.log('*** Invalid value "'+a+'" for enum '+this._getEnumName());return c};UUD.Enum=g;UUD.Severity=new UUD.Enum({Default:"error",warning:"warning",info:"info",error:"error"},"UUD.Severity");UUD.InputType=new UUD.Enum({Default:"features",features:"features",feature_ids:"feature-id list",auxiliary:"auxiliary file",query_track:"query track"},"UUD.InputType");
UUD.EntrezDB=new UUD.Enum({gene:"gene",nucleotide:"nucleotide",protein:"protein",clone:"clone"},"UUD.EntrezDB");UUD.UploadStatus={waiting:0,loading:1,complete:2,warnings:3,errors:4,failed:5,canceled:6};UUD.Log=window.console?function(){1===arguments.length?window.console.log(arguments[0]):1<arguments.length&&window.console.log(arguments)}:function(){};window.console&&jQuery.isFunction(window.console.error)?UUD.LogError=function(){1===arguments.length?window.console.error(arguments[0]):0===arguments.length?
window.console.error("Unspecified error"):window.console.error(arguments)}:UUD.LogError=function(a){UUD.Log("*** "+a)};UUD.Error=function(a,b){this.m_Severity=UUD.Severity.ValidatedValue(b);this.m_Description=a;this.m_Prefix=""};UUD.Error.prototype={SetPrefix:function(a){this.m_Prefix=a},toString:function(){return this.m_Severity+": "+this.m_Prefix+this.m_Description},Log:function(){switch(this.m_Severity){case UUD.Severity.error:UUD.LogError(this.toString());break;default:UUD.Log(this.toString())}}};
UUD.ReportErrors=function(a,b){0<b.length&&jQuery.each(b,function(b,d){d.SetPrefix(a);d.Log()})};var q="undefined"!==typeof FormData,p=function(){return"undefined"!==typeof GB},h=function(){return p()&&null!=GB.uploadDebug&&GB.uploadDebug()},t=function(a){if(null==a)return null;try{var b=a.replace(/\&quot;/g,"'"),c=jQuery.parseJSON(b);if(null!=c)return null!=c.percentage?c.percentage=parseInt(c.percentage):h()&&console.error("progress message: percentage not specified"),null==c.current_task&&h()&&
console.error("progress message: current_task not specified"),c}catch(d){console.error(d)}return null},w=function(a){try{return a.replace(/\&quot;/g,"'").replace(/[\r\n]/g," ").replace(/\\/g,""),jQuery.parseJSON(a)}catch(b){console.error(b)}return null},x=function(a){this.Reset(a||0);this.m_ProgressPct=0;this._PollInterval=2E3};x.prototype.Reset=function(a){this.m_ProgressPct=0;this.m_StdInterval=a;this.m_Timestamp=Date.now()};x.prototype.GetPollInterval=function(){var a=Date.now()-this.m_Timestamp,
b;try{0<this.m_ProgressPct?(b=(1-this.m_ProgressPct)*a/this.m_ProgressPct,b=Math.max(this._PollInterval,Math.min(b,.75*this.m_StdInterval))):b=Math.max(this._PollInterval,.75*this.m_StdInterval)}catch(c){console.error(c),b=this._PollInterval}return Math.round(b)};x.prototype.SetProgressPct=function(a){m_ProgressPct=a};g=function(){};g.prototype.notify=function(a,b,c){};g.prototype.finish=function(a,b,c){};var y=function(a){this.m_Delegate=a;return this};$jscomp.inherits(y,g);y.prototype.notify=function(a,
b,c){};y.prototype.finish=function(a,b,c){this.m_Delegate.finish(a)};var u=function(a,b){this.m_ProgressBar=a;a.setTitle(b);this._UploadSlice=.5;return this};$jscomp.inherits(u,g);u.prototype.notify=function(a,b,c){null!=c&&this.m_ProgressBar.setProgress(Math.min(1,c/100)*this._UploadSlice);this.m_ProgressBar.setStatus(b||"pending")};u.prototype.finish=function(a,b,c){this.m_ProgressBar.setFinished(b,c)};var C=function(a){this.m_PollTimer=a;return this};$jscomp.inherits(C,g);C.prototype.notify=function(a,
b,c){null!=c&&this.m_PollTimer.SetProgressPct(c/100)};var z=function(a){this.m_Iframe=a};z.prototype.getIFrame=function(){return this.m_Iframe};z.prototype.setError=function(a){return a};var A=function(a,b,c){this.m_Iframe=null;this.m_Delegate=a;this.m_Fn_GetIFrame=b;this.m_Fn_SetError=c;return this};$jscomp.inherits(A,z);A.prototype.getIFrame=function(){return this.m_Fn_GetIFrame.call(this.m_Delegate)};A.prototype.setError=function(a){return null==this.m_Fn_SetError?a:this.m_Fn_SetError.call(this.m_Delegate,
a)};var e=function(a,b){var c=a.assm_acc,d=a.check_cs,l=a.file,k=a.auxiliary_file,f=a.form,G=a.data,g=a.file_format,B=a.sadb,H=a.file_key,I=a.dataURL,h=a.dataRID,r=a.blast,p=a.track_name,q=a.filename,t=a.input_type,n=a.query_track,u=a.register_track,w=a.upload_file_only,v=a.iframe,D=a.dst,E=a.fastalign,m=this;this.m_NameLength=30;this.assm_acc=c;this.file=l;null!=k&&(a=new e(jQuery.extend({},a,{file:k,auxiliary_file:null,input_type:UUD.InputType.auxiliary,upload_file_only:!0})),a.upload(),this.m_AuxPromise=
a.getPromise());null!=f&&("FORM"===jQuery(f).prop("tagName")?this.form=f:console.error("form argument must be a <form> element"));this.data=G;this.sadb=B;this.file_key=H;this.dataURL=I;null!=g&&(this.m_File_format=g);this.m_Blast={};null!=h&&(console.error("dataRID is deprecated"),this.m_Blast.rid=h,this.m_Blast.link_related_hits=!1);this.m_CheckCS=d;null!=r&&(this.m_Blast.rid=r.rid,this.m_Blast.link_related_hits=!!r.link_related_hits);this.m_Observers=[];null!=v&&(this.m_IFrameDelegate=new z(this.iframe));
null!=b&&(this.addObserver(new y(b)),null==v&&(this.m_IFrameDelegate=new A(b,b.getIFrame,b.parseError)));this.m_Status=UUD.UploadStatus.waiting;this.track_name=p;this.filename=this.x_GetFilename(q);this.m_InputType=null==t&&null!=this.filename&&/\.ids?$/.test(this.filename)?UUD.InputType.feature_ids:UUD.InputType.ValidatedValue(t);null==D&&(D=null!=this.m_AuxPromise||this.m_InputType===UUD.InputType.auxiliary?"filetrack":"netcache");this.m_FileUploadDst=D;this.m_Fastalign=!!E;this._fileParams={discover_track:!0,
data_action:"uploading",input_form:"file"};this._urlParams={discover_track:!0,data_action:"uploading",input_form:"url"};this._blastParams={discover_track:!0,data_action:"uploading",input_form:"rid"};this._filekeyParams={discover_track:!0,data_action:"uploading",input_form:"file_key"};this.m_Promise=new jQuery.Deferred;this.m_InputType===UUD.InputType.query_track&&(b=!1,null!=n&&null!=n.features&&null!=n.features.entrez_db&&null!=UUD.InputType.ValidatedValue(n.features.entrez_db)&&null!=n.features.query&&
null!=n.featlocs&&null!=n.featlocs.track_ids&&jQuery.isArray(n.featlocs.track_ids)&&0!==n.featlocs.track_ids.length||(console.error("query_track structure is missing required fields or values"),b=!0),this.m_QueryTrackParams=n,b||null!=this.track_name&&0!==this.track_name.length||(this.track_name=this.m_QueryTrackParams.features.entrez_db+" - "+this.m_QueryTrackParams.features.query),this.registerProperties({}));this.name=function(){if(null!=m.track_name)return m.track_name;if(null!=m.sadb)return m.sadb;
var a=m.x_GetFilename();return null!=a&&"Unnamed"!==a?a:null!=m.dataURL?F(m.dataURL):null!=m.m_Blast.rid?"BLAST RID "+m.m_Blast.rid:null!=m.data?m.data.substr(0,m.m_NameLength).replace(/^[ \t\n\r]+|[ \t\n\r]+$/g,"").replace(/[ \t\n\r]+/g,"_")+"...":null}()||"<unnamed>";this.m_UploadingFeatIdList=this.m_UploadingQueryTrack=null;this.m_Errors=[];this.m_PollTimer=new x;this.addObserver(new C(this.m_PollTimer));this.m_RegisterTrack=null==u?!0:!!u;this.m_UploadOnly=!!w};e.prototype.addObserver=function(a){this.m_Observers.push(a)};
e.prototype.removeObserver=function(a){};e.prototype.x_NotifyObserversProgress=function(a,b){var c=this;this.m_Status===UUD.UploadStatus.complete||this.m_Status===UUD.UploadStatus.failed||this.m_Status===UUD.UploadStatus.canceled?this.finish():(jQuery.each(this.m_Observers,function(d,l){l.notify(c,a,b)}),this.m_Promise.notifyWith(this,[{current_task:a,percentage:b}]))};e.prototype.x_NotifyObserversFinish=function(){var a=this;jQuery.each(this.m_Observers,function(b,c){c.finish(a,a.m_Status,a.m_Errors)})};
e.prototype.getPromise=function(){return this.m_Promise.promise()};e.prototype.setProgressBar=function(a){this.addObserver(new u(a,this.getName()));a.setCancelCallback(this.cancel,this)};e.prototype.getName=function(){return this.name};e.prototype.getMetadata=function(){return this.m_Dl_metadata};e.prototype.x_SetMetadata=function(a){this.m_Dl_metadata=a};e.prototype.x_GetFilename=function(a){return null!=a?a:null!=this.filename?this.filename:null!=this.file?this.file.name:null!=this.form&&this.form.hasOwnProperty("file")&&
null!=this.form.file.value?F(this.form.file.value):"Unnamed"};e.prototype.setStatus=function(a){a>this.m_Status&&(this.m_Status=a)};e.prototype.getUploadStatus=function(){switch(this.m_Status){case UUD.UploadStatus.complete:case UUD.UploadStatus.warnings:case UUD.UploadStatus.errors:return"complete";case UUD.UploadStatus.failed:return"failed";case UUD.UploadStatus.canceled:return"canceled";default:return"loading"}};e.prototype.registerProperties=function(a){this._props=jQuery.extend(this._props,a)};
e.prototype.x_AddCallbacks_FLS_DL=function(a,b){var c=this;return a.done(function(a,l,e){!0===a.success&&null!=a.key&&0<a.key.length&&(c.file_key=a.key);c.x_AcceptFromUpload(a,l,e,b);c.file_key||c.reportError("error looking up locations for feature-ids")}).fail(function(a,l,e){var d=w(a.responseText);if(null!=d&&"parsererror"===l)c.x_AcceptFromUpload(d,l,a,b);else{var k;null!=d&&d.hasOwnProperty("messages")&&0<d.messages.length&&(d=jQuery.grep(d.messages,function(a){return"error"===a.level}),0<d.length&&
(k=d[0].message));c.reportError(k||e,l,a)}})};e.prototype.x_AddCallbacks_FeatQueryDL=function(a){this.x_AddCallbacks_FLS_DL(a,{url_tag:"featqry-dl",add_callbacks:this.x_AddCallbacks_FeatQueryDL})};e.prototype.x_AddCallbacks_FeatIdListDL=function(a){this.x_AddCallbacks_FLS_DL(a,{url_tag:"featid-dl",add_callbacks:this.x_AddCallbacks_FeatIdListDL})};e.prototype.x_AddCallbacks_SVDL=function(a){var b=this,c={url_tag:"sv-dl",add_callbacks:this.x_AddCallbacks_SVDL};return a.done(function(a,l,e){b.x_AcceptFromUpload(a,
l,e,c)}).fail(function(a,e,k){if("parsererror"===e){var d=w(a.responseText);if(null!=d){b.x_AcceptFromUpload(d,e,a,c);return}}b.reportError(k,e,a)})};e.prototype.x_PollStatus=function(a,b){try{if(null==a)return this.reportError("[internal error] endpoint not specified"),null;var c=jQuery.ajax({type:"POST",async:!0,dataType:"json",url:UUD.GetUUDCgiUrl(a.url_tag),xhrFields:{withCredentials:!0},data:{job_key:b}});null!=a.add_callbacks&&jQuery.isFunction(a.add_callbacks)&&a.add_callbacks.apply(this,[c])}catch(d){console.error(d),
this.reportError(d)}};e.prototype.x_AcceptFromPoll=function(a,b,c,d){var e=this;this.isCanceled()?this.needsCancel&&"failed"!==a.job_status&&"canceled"!==a.job_status&&a.job_id&&(setTimeout(function(){e.x_CancelJob(a.job_id)},50),delete this.needsCancel):(delete this.m_Job_id,null!=a.key&&0<a.key.length?(this.m_PollDuration=Date.now()-this.m_StartTimestamp,h()&&console.debug("- total poll time: "+String(this.m_PollDuration/1E3)),this.m_UploadingQueryTrack?(this.m_UploadingQueryTrack=!1,this.upload()):
this.m_UploadingFeatIdList?(this.m_UploadingFeatIdList=!1,this.upload()):this.x_FetchMetadata(a.key)):"failed"===a.job_status||"canceled"===a.job_status?(a.error_message&&console.error(a.error_message),this.setStatus(UUD.UploadStatus.failed),this.finish()):a.job_id&&(this.m_Job_id=a.job_id,a.hasOwnProperty("progress_message")&&(b=t(a.progress_message),null!=b&&this.x_NotifyObserversProgress(b.current_task,b.percentage)),b=this.getPollInterval(),h()&&console.debug("+ polling in "+String(b/1E3)+" sec"),
setTimeout(function(){e.x_PollStatus(d,a.job_id)},b)))};e.prototype.x_AcceptFromUpload=function(a,b,c,d){h()&&console.debug("- upload time: "+String(this.m_UploadDuration/1E3));this.m_StartTimestamp=Date.now();null==a.success||!0===a.success?this.x_AcceptFromPoll(a,b,c,d):this.isCanceled()||(console.error(a.msg),this.reportError(a.msg))};e.prototype.x_FetchMetadata=function(a){var b=this,c=Date.now();try{jQuery.ajax({type:"POST",async:!0,dataType:"json",url:UUD.GetUUDCgiUrl("dl-meta"),xhrFields:{withCredentials:!0},
data:{key:a}}).done(function(a,e,k){b.m_FetchDuration=Date.now()-c;h()&&console.log("- meta fetch time: "+String(b.m_FetchDuration/1E3)+" sec");b.isCanceled()||(b.m_SeqDataKey=a.hasOwnProperty("seq_data_key")?a.seq_data_key:null,b.x_SetMetadata(a),b.x_NotifyObserversProgress("Retrieved metadata"),b.x_AddTracks(a))}).fail(function(a,c,e){b.isCanceled()||b.reportError(e,c,a)})}catch(d){console.error(d),this.reportError(d)}};e.prototype.reportError=function(a,b,c){console.error((b||"Error")+": "+a);
this.x_AddError(a);p()&&GB.pingError(a,"FileUpload");this.setStatus(UUD.UploadStatus.failed);this.finish()};e.prototype.x_SetTrackData=function(a){this.m_Tracks=a;this.m_TrackList=new TMS.NamedTrackList(a,"uud tracks")};e.prototype.x_AddCallbacks_Register=function(a){var b=this,c=Date.now();a.done(function(a){b.m_TrackDuration=Date.now()-c;b.x_SetTrackData(a.tracks);b.setStatus(UUD.UploadStatus.complete);b.finish()}).fail(function(a,c,e){b.isCanceled()||(b.reportError(e,c,a),b.setStatus(UUD.UploadStatus.failed),
b.finish())})};e.prototype.x_AddTracks=function(a){if(this.m_RegisterTrack){if(a.error_msg)for(var b=a.error_msg,b=b.replace(/<br><br>/g,"\n").replace(/<br>/g," ").replace(/problem:/ig,"").replace(/[ ]{2,}/g," ").replace(/^[ ]+/g,"").replace(/\n[ ]+/g,"\n").replace(/\n$/g,"").replace(/[ ]*line:[ ]*/gi,", line "),b=b.split("\n"),c=0;c<b.length;c++)this.x_AddError(b[c]),console.error(b[c]);if(a.tracks)try{this.x_NotifyObserversProgress("Registering tracks");var d=UUD.RegisterSVDLTracks(a,this.getName(),
this._props);this.x_AddCallbacks_Register(d)}catch(l){console.error(l),this.isCanceled()||this.reportError(l,"UUD")}else this.reportError(a.msg||"Track discovery failed",a.msg?"Meta":"UUD"),this.setStatus(UUD.UploadStatus.errors)}else this.setStatus(UUD.UploadStatus.complete),this.finish()};e.prototype.hasErrors=function(){return 0<this.m_Errors.length};e.prototype.getErrorCount=function(){return null!=this.m_Dl_metadata&&this.m_Dl_metadata.hasOwnProperty("error_num")?this.m_Dl_metadata.error_num:
this.m_Errors.length};e.prototype.getErrors=function(){return this.m_Errors.slice()};e.prototype.x_AddError=function(a){this.m_Errors.push(a)};e.prototype.finish=function(){h()&&(GB.ping({jsevent:"statistics",action:"FinishUpload",upload:this.m_UploadDuration?this.m_UploadDuration/1E3:"n/a",poll:this.m_PollDuration?this.m_PollDuration/1E3:"n/a",fetch_meta:this.m_FetchDuration?this.m_FetchDuration/1E3:"n/a",register_tracks:this.m_TrackDuration?this.m_TrackDuration/1E3:"n/a"}),console.debug("FileUpload statistics: "+
this.getName()+"\n"+(this.m_UploadDuration?" - uploading:       "+String(this.m_UploadDuration/1E3)+" sec\n":"")+(this.m_PollDuration?" - polling:         "+String(this.m_PollDuration/1E3)+" sec\n":"")+(this.m_FetchDuration?" - fetch meta:      "+String(this.m_FetchDuration/1E3)+" sec\n":"")+(this.m_TrackDuration?" - register tracks: "+String(this.m_TrackDuration/1E3)+" sec\n":"")));!this.hasErrors()||this.m_Status!==UUD.UploadStatus.complete&&this.m_Status!==UUD.UploadStatus.warnings||(this.m_Status=
UUD.UploadStatus.errors);this.x_NotifyObserversFinish();switch(this.m_Status){case UUD.UploadStatus.failed:case UUD.UploadStatus.canceled:this.m_Promise.rejectWith(this);break;case UUD.UploadStatus.complete:case UUD.UploadStatus.warnings:case UUD.UploadStatus.errors:this.m_Promise.resolveWith(this,[this.x_GetTrackList(),this.x_GetSeqDataKey(),this]),!this.m_UploadOnly&&p()&&null!=GB.Notification&&GB.Notification.postNotification("DL.UpdateUserTracks",this)}};e.prototype.cancel=function(){this.m_Job_id?
this.x_CancelJob(this.m_Job_id):null!=this.m_Current_xhr?(this.m_Current_xhr.abort(),this.m_Current_xhr=null):this.needsCancel=!0;this.setStatus(UUD.UploadStatus.canceled);this.finish()};e.prototype.x_CancelJob=function(a){console.debug("+ cancelling job '"+a+"'");try{jQuery.ajax({type:"POST",async:!0,dataType:"json",url:UUD.GetUUDCgiUrl("sv-dl"),xhrFields:{withCredentials:!0},data:{job_key:a,cancel:"cancel"}}).done(function(a,c,d){console.debug("+ job canceled: "+JSON.stringify(a))}).fail(function(b,
c,d){console.debug("+ failed to cancel job '"+a+"': "+testStatus+", "+d)})}catch(b){console.error(b)}};e.prototype.isCanceled=function(){return this.m_Status===UUD.UploadStatus.canceled};e.prototype.x_ClearForm=function(){if(this.form){var a=this.form.parentNode;null!=a&&a.parentNode&&a.parentNode.removeChild(a)}delete this.form};e.prototype.getTracks=function(){return this.m_Tracks};e.prototype.x_GetTrackList=function(){return this.m_TrackList};e.prototype.x_GetSeqDataKey=function(){return this.m_SeqDataKey};
e.prototype.getPollInterval=function(){return this.m_PollTimer.GetPollInterval()};e.prototype.x_Submit=function(a,b,c){var d=this;this.x_NotifyObserversProgress("pending");try{var e,k=function(a,b,c){d.m_Current_xhr=null};if(null==this.file_key&&null==this.dataURL&&null==this.m_Blast.rid&&this.m_InputType!==UUD.InputType.query_track){this.x_NotifyObserversProgress("uploading file",0);var f=UUD.GetUUDCgiUrl("file-upload")+"?dst="+this.m_FileUploadDst,g=function(){d.reportError("error uploading file");
d.setStatus(UUD.UploadStatus.failed);d.finish()};e=jQuery.ajax(jQuery.extend({type:"POST",async:!0,dataType:"json",url:f,contentType:!1,xhrFields:{withCredentials:!0},processData:!1,data:a},c)).always(k).always(function(a,c,e){d.m_UploadDuration=Date.now()-b;d.m_PollTimer.Reset(d.m_UploadDuration)}).fail(g).done(function(a,b,c){!0!==a.success?g():(d.file_key=a.key,null==d.filename&&(d.filename=d.name),d.m_UploadOnly?(d.setStatus(UUD.UploadStatus.complete),d.finish()):null!=d.m_AuxPromise?d.m_AuxPromise.done(function(b,
c,e){!0===a.success?(console.log("file_uploads complete, adding aux_file_key to upload"),d.aux_file_key=e.file_key,d.upload()):(d.reportError("error uploading auxiliary data file"),d.setStatus(UUD.UploadStatus.failed),d.finish())}):d.upload())})}else if(this.m_InputType===UUD.InputType.query_track&&null===this.m_UploadingQueryTrack){this.m_UploadingQueryTrack=!0;this.x_NotifyObserversProgress("processing feature query");var h=jQuery.extend({},this.m_QueryTrackParams.features,this.m_QueryTrackParams.featlocs);
null!=h.track_ids&&jQuery.isArray(h.track_ids)&&(h.track_ids=h.track_ids.join(","));e=jQuery.ajax(jQuery.extend({type:"POST",async:!0,dataType:"json",url:UUD.GetUUDCgiUrl("featqry-dl"),xhrFields:{withCredentials:!0},processData:!0,data:h},c)).always(k).always(function(a,c,e){d.hasOwnProperty("m_PollTimer")||(d.m_UploadDuration=Date.now()-b,d.m_PollTimer.Reset(d.m_UploadDuration))});this.x_AddCallbacks_FeatQueryDL(e)}else this.m_InputType===UUD.InputType.feature_ids&&null===this.m_UploadingFeatIdList?
(this.m_UploadingFeatIdList=!0,this.x_NotifyObserversProgress("processing feature-id list"),e=jQuery.ajax(jQuery.extend({type:"POST",async:!0,dataType:"json",url:UUD.GetUUDCgiUrl("featid-dl"),contentType:!1,xhrFields:{withCredentials:!0},processData:!1,data:a},c)).always(k).always(function(a,c,e){d.hasOwnProperty("m_PollTimer")||(d.m_UploadDuration=Date.now()-b,d.m_PollTimer.Reset(d.m_UploadDuration))}),this.x_AddCallbacks_FeatIdListDL(e)):this.m_InputType!==UUD.InputType.auxiliary&&(this.m_UploadingFeatIdList=
this.m_UploadingQueryTrack=null,this.x_NotifyObserversProgress("processing locations"),e=jQuery.ajax(jQuery.extend({type:"POST",async:!0,dataType:"json",url:UUD.GetUUDCgiUrl("sv-dl"),contentType:!1,xhrFields:{withCredentials:!0},processData:!1,data:a},c)).always(k).always(function(a,c,e){d.hasOwnProperty("m_PollTimer")||(d.m_UploadDuration=Date.now()-b,d.m_PollTimer.Reset(d.m_UploadDuration))}),this.x_AddCallbacks_SVDL(e));e.always(function(a,b,c){d.x_ClearForm()});this.m_Current_xhr=e}catch(B){console.error(B),
this.reportError(B)}};e.prototype.upload=function(){var a=this,b=Date.now();this.setStatus(UUD.UploadStatus.loading);var c=function(a,b,c){null!=a&&null!=b&&null!=c&&(a[b]=c)};if(q){var d=function(a,b,c){null!=a&&null!=b&&null!=c&&a.append(b,c)},c=function(a,b,c){jQuery.each(b,function(b,e){c.hasOwnProperty(b)&&d(a,b,c[b])})},e=this,k=function(){var a=new FormData;d(a,"assm_acc",e.assm_acc);var b=/^(?:.*,)?svdl(?:,.*)?$/;p()&&GB.config&&b.test(GB.config.debug)&&d(a,"save_all_data","true");e.m_CheckCS&&
d(a,"check_cs",!0);null!=e.track_name&&d(a,"track_name",e.track_name);d(a,"fastalign",e.m_Fastalign.toString());return a},f;if(null!=this.file_key)f=k(),d(f,"file_key",this.file_key),null!=this.aux_file_key&&d(f,"aux_file_key",this.aux_file_key),d(f,"file_name",this.filename),d(f,"track_name",this.name),d(f,"file_format",this.m_File_format),c(f,this._filekeyParams,this._filekeyParams);else if(null!=this.file)f=k(),d(f,"file",this.file,this.file.name),d(f,"file_format",this.m_File_format),c(f,this._fileParams,
this._fileParams);else if(null!=this.data)f=k(),d(f,"file",this.data),d(f,"file_format",this.m_File_format),c(f,this._fileParams,this._fileParams);else if(null!=this.form)this.form.hasOwnProperty("assm_acc")&&(this.form.assm_acc.value=this.assm_acc),f=new FormData(this.form);else{if(null!=this.sadb){this.x_SubmitSADB(this.sadb);return}if(null!=this.dataURL)f=k(),d(f,"url",this.dataURL),d(f,"file_format",this.m_File_format),c(f,this._urlParams,this._urlParams);else if(null!=this.m_Blast.rid)f=k(),
d(f,"rid",this.m_Blast.rid),d(f,"find_comp",this.m_Blast.link_related_hits),c(f,this._blastParams,this._blastParams);else if(this.m_InputType!==UUD.InputType.query_track||null==this.m_QueryTrackParams)throw"FileUploader has neither a file nor a form";}null!=f&&this.x_Submit(f,b)}else if(null!=this.data)f={file:this.data,assm_acc:this.assm_acc,discover_track:"true",input_form:"file"},null!=this.track_name&&c(f,"track_name",this.track_name),c(f,"file_format",this.m_File_format),this.x_Submit(f,b,{processData:!0});
else if(null!=this.dataURL)f={url:this.dataURL,assm_acc:this.assm_acc,track_name:this.name,discover_track:"true",input_form:"url"},c(f,"track_name",this.track_name),c(f,"file_format",this.m_File_format),this.x_Submit(f,b,{processData:!0});else if(null!=this.m_Blast.rid)f={rid:this.m_Blast.rid,find_comp:this.m_Blast.link_related_hits.toString(),assm_acc:this.assm_acc,discover_track:"true",input_form:"rid"},c(f,"file_format",this.m_File_format),this.x_Submit(f,b,{processData:!0});else if(this.form)if(null==
this.m_IFrameDelegate)console.error("FileUpload: form-based upload requires an iframe delegate");else{var g=this.m_IFrameDelegate.getIFrame(),h=function(c){try{a.m_UploadDuration=Date.now()-b;jQuery(g).unbind("load",h);var d,e;d=g.contentDocument?g.contentDocument.body.innerHTML:g.contentWindow.document.body.innerHTML;if(/^[ \t\n]*[\{\[]/.test(d))try{d=jQuery.trim(d),e=JSON.parse(d),a.x_AcceptFromUpload(e),a.x_ClearForm()}catch(r){console.error(r),a.reportError(r),a.x_ClearForm()}else{var f=a.m_IFrameDelegate.setError(d);
console.error("FileUpload: upload failed - "+(f||"unknown error"));a.reportError(f||"upload failed");a.x_ClearForm()}}catch(r){console.error(r)}};this.x_NotifyObserversProgress("pending");jQuery(g).bind("load",h);this.form.hasOwnProperty("assm_acc")&&(this.form.assm_acc.value=this.assm_acc);null!=this.track_name&&null!=this.form.track_name&&(this.form.track_name.value=this.track_name);null!=this.m_File_format&&null!=this.form.file_format&&(this.form.file_format.value=this.m_File_format);this.m_CheckCS&&
(this.form.check_cs.value="true");this.form.action=UUD.GetUUDCgiUrl("sv-dl");this.form.submit()}else this.sadb?this.x_SubmitSADB(this.sadb):console.error("FileUpload: no upload form in outdated browser")};e.prototype.x_SubmitSADB=function(a){if(null!=a)try{this.x_NotifyObserversProgress("Registering tracks");var b=TMS.RegisterSADBTrack(a,null,this.assm_acc,this._props);this.x_AddCallbacks_Register(b)}catch(c){console.error(c),this.isCanceled()||this.reportError(c,"UUD")}};var F=function(a){if(a){var b=
a.lastIndexOf("/");0>b&&(b=a.lastIndexOf("\\"));0<=b&&(a=a.substr(b+1));b=a.indexOf("?",1);0<=b&&(a=a.substr(0,b))}return a};UUD.FileUploader=e;UUD.CreateTrackForDataKey=function(a,b,c){if(null==a)return jQuery.Deferred().reject();b=null!=b?b:"nckey "+a;a=new e(jQuery.extend({filename:b,file_key:a,track_name:b},c));null!=c&&c.hasOwnProperty("track_group")&&a.registerProperties({track_group:c.track_group});a.upload();return a.getPromise()};var E=function(){var a=jQuery("#breadcrumb");return 0<a.length?
(a=a.html().match(/Job id=([^\s<]+)/))&&1<a.length?a[1]:null:null},v=function(a){return(new jQuery.Deferred(function(b){null!=a&&jQuery.isArray(a)?b.rejectWith(b,a):b.reject()})).promise()};UUD.RegisterBlastRID=function(a){(new UUD.Error("Blast RID registration not currently supported",UUD.Severity.error)).Log();return v([null,"error","Blast RID registration not currently supported"])};var J=function(a,b){return a.done(function(a,d,e){d=[];if(a.hasOwnProperty("messages")&&(d=jQuery.map(a.messages,
function(a,b){if(a.hasOwnProperty("level")&&"error"===a.level)return a.message}),0<d.length)){b.rejectWith(b,[e,"error",d.join("\n")]);return}var c=[];a.hasOwnProperty("tracks")&&jQuery.each(a.tracks,function(a,b){b.hasOwnProperty("display_tracks")&&jQuery.each(b.display_tracks,function(a,b){c.push(TMS.TrackMgr.GetTrackInfo(b,"tmssvc"))})});0<c.length?b.resolve({tracks:c}):b.rejectWith(b,[e,"error","no tracks registered"])}).fail(function(a,d,e){b.rejectWith(b,[a,"error","unable to register tracks: "+
e])})};UUD.RegisterSVDLTracks=function(a,b,c){var d=function(a,b){(new UUD.Error(a,b)).Log();return v([null,"error",a])};if(null==a)return d("Data upload failed",UUD.Severity.error);if(!a.hasOwnProperty("tracks"))return d("Data discovery failed",UUD.Severity.error);a={dlkey:a.icache_key};null!=c&&(null!=c.track_group&&(a.tg=c.track_group),null!=c.track_subgroup&&(a.tsg=c.track_subgroup));null!=b&&(a.tname=b);10<document.URL.search(/primertool.cgi/)&&(b=E(),null!==b&&(a.pb_jobid=b));b=new jQuery.Deferred;
c=jQuery.ajax({dataType:"json",async:!0,type:"POST",url:UUD.GetUUDCgiUrl("registerdl"),data:a,xhrFields:{withCredentials:!0}});J(c,b);return b.promise()}})(jQuery);
